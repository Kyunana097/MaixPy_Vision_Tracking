# 实时摄像头GUI使用说明

## 功能概述

本系统提供了三种不同的实时摄像头界面，支持人脸检测、识别、记录和管理功能。每种界面都有不同的特点和适用场景。

## 界面版本

### 1. 完整版GUI (`camera_gui.py`)
**特点**: 功能最全面，支持多种模式切换
- 实时检测和识别
- 交互式记录模式
- 完整的状态管理
- 详细的UI显示

**使用场景**: 开发和调试阶段

### 2. 简化版GUI (`simple_camera_gui.py`)
**特点**: 精简实用，自动化程度高
- 自动演示功能
- 简化的用户界面
- 适合演示和测试
- 减少了复杂的交互

**使用场景**: 快速演示和功能验证

### 3. 按键控制版GUI (`button_camera_gui.py`)
**特点**: 专为物理按键设计
- 支持GPIO按键输入
- 防抖和长按检测
- 适合嵌入式应用
- 实时硬件状态显示

**使用场景**: 最终产品部署

## 核心功能

### 1. 实时画面显示
- **分辨率**: 512x320 (可调整)
- **帧率**: 约30FPS
- **显示内容**: 
  - 摄像头实时画面
  - 人脸检测框（绿色）
  - 人脸区域框（青色）
  - 识别结果标注

### 2. 人脸记录功能
- **触发方式**: 按键控制
- **记录过程**: 
  1. 按下"记录"按键
  2. 检测到人脸后开始采样
  3. 自动采集3个样本
  4. 完成注册并保存
- **状态显示**: 实时显示记录进度

### 3. 人脸识别功能
- **实时识别**: 自动识别已注册人物
- **置信度显示**: 显示识别置信度
- **未知人物检测**: 标记未知人物
- **颜色编码**:
  - 绿色框: 检测到的人物
  - 红色标注: 已知人物
  - 白色标注: 未知人物
  - 黄色框: 记录模式

### 4. 数据管理功能
- **清除记录**: 一键删除所有已注册人物
- **状态查询**: 显示当前注册状态
- **数据持久化**: 自动保存到文件系统

## 使用方法

### 基本启动

```bash
# 完整版GUI
python examples/camera_gui.py

# 简化版GUI
python examples/simple_camera_gui.py

# 按键控制版GUI
python examples/button_camera_gui.py

# 指定分辨率启动
python examples/camera_gui.py 640 480
```

### 操作指南

#### 完整版GUI操作
1. **检测模式**: 默认模式，实时显示检测和识别结果
2. **记录模式**: 
   - 按R键进入记录模式
   - 系统自动生成人物名称
   - 自动采集样本完成注册
3. **清除数据**: 按C键清除所有记录
4. **退出程序**: 按Q键或Ctrl+C

#### 简化版GUI操作
- **自动演示**: 程序自动循环演示各种功能
- **观察模式**: 主要用于观察和验证功能
- **退出程序**: Ctrl+C退出

#### 按键控制版GUI操作
- **记录按键**: 
  - 短按: 开始/取消记录
  - 长按: 保留功能（可自定义）
- **清除按键**: 删除所有记录
- **状态显示**: 实时显示按键状态

## 硬件连接（按键版）

### GPIO连接示例
```
MaixCAM GPIO 连接:
├── 记录按键
│   ├── 一端 → GPIO引脚 (如GPIO1)
│   └── 另一端 → GND
├── 清除按键  
│   ├── 一端 → GPIO引脚 (如GPIO2)
│   └── 另一端 → GND
└── 上拉电阻 → VCC (可选，内部上拉)
```

### 按键配置
```python
# 在button_camera_gui.py中修改按键引脚
RECORD_BUTTON_PIN = 1  # 记录按键GPIO引脚
CLEAR_BUTTON_PIN = 2   # 清除按键GPIO引脚

# 按键参数
DEBOUNCE_TIME = 0.3      # 防抖时间
LONG_PRESS_TIME = 2.0    # 长按时间阈值
```

## 界面元素说明

### 屏幕布局
```
┌─────────────────────────────────┐
│ 标题: 人脸识别系统              │
│ 状态: 已注册 2/3                │
│ 模式: 实时模式                  │
│ 按键: 记录键-释放 清除键-释放   │
│ FPS: 29.8                      │
│                                │
│        [摄像头画面区域]          │
│                                │
│                                │
│ 操作说明:                      │
│ 记录键短按: 记录人脸           │
│ 清除键: 删除所有记录           │
└─────────────────────────────────┘
```

### 颜色编码
- **绿色框**: 检测到的人物（正常状态）
- **黄色框**: 记录模式下的检测框
- **红色标注**: 已识别的已知人物
- **白色标注**: 未知人物
- **青色框**: 人脸区域框

### 状态指示
- **实时模式**: 正常检测和识别
- **记录模式**: 正在记录新人物
- **按键状态**: 显示物理按键的当前状态

## 性能参数

### 系统性能
- **帧率**: 25-30 FPS
- **检测延迟**: < 100ms
- **识别延迟**: < 50ms
- **内存使用**: < 100MB

### 识别参数
- **最大人数**: 3个
- **样本数量**: 每人3个样本
- **相似度阈值**: 0.85
- **特征维度**: 64维

## 故障排除

### 常见问题

1. **摄像头无法打开**
   ```bash
   # 检查摄像头设备
   ls /dev/video*
   
   # 确认摄像头权限
   sudo chmod 666 /dev/video0
   ```

2. **按键无响应**
   - 检查GPIO连接
   - 确认引脚配置
   - 验证上拉/下拉电阻

3. **检测效果差**
   - 调整光照条件
   - 确保人脸正面朝向
   - 检查摄像头焦距

4. **识别准确率低**
   - 增加训练样本
   - 调整相似度阈值
   - 改善注册时的图像质量

### 调试模式
```python
# 启用调试输出
DEBUG = True

# 显示检测参数
detector.get_debug_info()

# 显示识别状态
recognizer.get_status_info()
```

## 自定义配置

### 修改界面参数
```python
# 摄像头分辨率
CAMERA_WIDTH = 512
CAMERA_HEIGHT = 320

# 检测参数
PHOTO_SIZE_CM = 5.0      # 照片尺寸
MIN_DISTANCE_CM = 50.0   # 最小距离
SIMILARITY_THRESHOLD = 0.85  # 相似度阈值

# 界面参数
FPS_TARGET = 30          # 目标帧率
UI_UPDATE_INTERVAL = 33  # 界面更新间隔(ms)
```

### 添加新功能
```python
# 扩展按键功能
def _handle_custom_button(self, press_type):
    if press_type == 'long':
        # 自定义长按功能
        pass

# 添加新的识别模式
def _process_special_mode(self, img, detections):
    # 自定义处理逻辑
    pass
```

## 集成说明

### 与主系统集成
1. **导入模块**:
   ```python
   from examples.button_camera_gui import ButtonCameraGUI
   ```

2. **创建实例**:
   ```python
   gui = ButtonCameraGUI()
   ```

3. **运行界面**:
   ```python
   gui.run()
   ```

### 事件回调
```python
# 注册完成回调
def on_person_registered(person_id, person_name):
    print(f"新人物注册: {person_name}")

# 识别结果回调  
def on_person_recognized(person_id, confidence, person_name):
    print(f"识别到: {person_name} ({confidence:.2f})")

# 绑定回调
gui.on_person_registered = on_person_registered
gui.on_person_recognized = on_person_recognized
```

## 未来扩展

### 可能的改进
1. **触摸屏支持**: 添加触摸操作
2. **语音控制**: 支持语音命令
3. **网络功能**: 远程管理和同步
4. **多摄像头**: 支持多个摄像头输入
5. **高级识别**: 年龄、性别等属性识别

### 性能优化
1. **多线程处理**: 分离检测和显示线程
2. **硬件加速**: 使用GPU加速
3. **模型优化**: 使用更高效的检测模型
4. **内存管理**: 优化内存使用
