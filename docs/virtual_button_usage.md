# 虚拟按键界面使用说明

## 功能概述

虚拟按键界面在MaixCAM显示屏上提供了两个虚拟按键，无需外接物理按键即可完成人脸记录和清除操作。

## 界面版本

### 1. 触摸屏版 (`touchscreen_camera_gui.py`)
**特点**: 支持真实触摸操作
- 触摸屏检测和响应
- 专业的触摸事件处理
- 适合有触摸功能的设备

### 2. 虚拟按键版 (`virtual_button_gui.py`) ⭐ **推荐**
**特点**: 自动演示 + 清晰界面
- 自动循环演示功能
- 清晰的按键状态显示
- 适合演示和测试

## 界面布局

```
┌─────────────────────────────────────────────────────┐
│ 虚拟按键人脸识别                                    │
│ 注册: 2/3                                           │
│ 实时检测模式                                        │
│ 演示模式 - 运行时间: 15.3s                          │
│                                                     │
│                                                     │
│      [摄像头实时画面区域]                           │ ┌─────┐
│        📷 人脸检测                                   │ │记录 │
│                                                     │ └─────┘
│                                                     │ ┌─────┐
│                                                     │ │清除 │
│ 虚拟按键:                                           │ └─────┘
│ 绿色=记录人脸                                       │
│ 红色=清除记录                                       │
└─────────────────────────────────────────────────────┘
```

## 核心功能

### 🎯 **虚拟按键**

#### 记录按键 (绿色)
- **位置**: 屏幕右下角上方
- **功能**: 
  - 点击开始记录新人物
  - 记录中时点击可取消
- **状态显示**:
  - 暗绿色: 等待状态
  - 亮绿色: 点击激活
  - 暗黄色: 记录中 (显示"取消")
  - 亮黄色: 取消激活

#### 清除按键 (红色)
- **位置**: 屏幕右下角下方
- **功能**: 删除所有已注册人物
- **状态显示**:
  - 暗红色: 可用状态
  - 亮红色: 点击激活
  - 灰色: 禁用状态 (无记录时)

### 📸 **摄像头显示**
- **实时画面**: 512x320高清显示
- **检测标记**: 
  - 绿色框: 正常检测
  - 黄色框: 记录模式
  - 青色框: 人脸区域
- **识别结果**:
  - 红色标注: 已知人物
  - 白色标注: 未知人物

### 🔄 **自动演示**
系统每25秒循环演示以下操作：
1. **3秒**: 点击记录按键 → 开始记录
2. **8秒**: 再次点击 → 取消记录
3. **12秒**: 点击记录按键 → 再次记录
4. **20秒**: 点击清除按键 → 清除记录

## 使用方法

### 基本启动
```bash
# 推荐版本 - 虚拟按键
python examples/virtual_button_gui.py

# 触摸屏版本
python examples/touchscreen_camera_gui.py

# 指定分辨率
python examples/virtual_button_gui.py 640 480
```

### 操作流程

#### 记录新人物
1. **准备阶段**: 将人脸对准摄像头
2. **开始记录**: 观察绿色"记录"按键变亮 (演示模式自动点击)
3. **采样过程**: 
   - 系统自动采集3个样本
   - 黄色框标记记录状态
   - 界面显示进度 "记录中: 人物X (1/3)"
4. **完成记录**: 自动返回实时模式

#### 清除记录
1. **触发清除**: 观察红色"清除"按键变亮
2. **执行清除**: 系统删除所有已注册人物
3. **状态更新**: 注册数量归零，清除按键变灰

#### 实时识别
- **自动运行**: 系统持续检测和识别
- **结果显示**: 
  - 已知人物: 红色标注 + 姓名
  - 未知人物: 白色标注 "未知"

## 界面元素说明

### 状态信息区域 (左上角)
```
虚拟按键人脸识别          ← 系统标题
注册: 2/3                 ← 当前注册状态
实时检测模式               ← 工作模式
演示模式 - 运行时间: 15.3s ← 演示计时
```

### 按键状态显示
- **点击效果**: 按键被点击时显示白色内边框
- **状态变化**: 颜色实时反映按键状态
- **文字变化**: 记录按键在不同状态下显示不同文字

### 提示信息区域 (左下角)
```
虚拟按键:        ← 操作说明标题
绿色=记录人脸     ← 绿色按键功能
红色=清除记录     ← 红色按键功能
```

## 技术特点

### 🎨 **视觉设计**
- **颜色编码**: 直观的颜色状态系统
- **动态反馈**: 实时的状态变化显示
- **清晰布局**: 信息区域合理分布

### ⚡ **性能优化**
- **高帧率**: 30FPS流畅显示
- **快速响应**: 0.2秒按键响应时间
- **内存友好**: 优化的资源使用

### 🛡️ **稳定性**
- **防误操作**: 0.5秒点击冷却时间
- **错误恢复**: 完善的异常处理
- **状态同步**: 界面与数据状态一致

## 自定义配置

### 修改按键位置
```python
# 在 VirtualButtonGUI.__init__ 中修改
self.buttons = {
    'record': {
        'x': 400,  # 按键X坐标
        'y': 250,  # 按键Y坐标
        'w': 80,   # 按键宽度
        'h': 35,   # 按键高度
        # ... 其他配置
    }
}
```

### 调整演示时序
```python
# 修改演示序列
self.demo_sequence = [
    {'time': 5, 'button': 'record', 'description': '延迟记录'},
    {'time': 15, 'button': 'clear', 'description': '延迟清除'}
]
```

### 修改采样参数
```python
# 修改记录配置
self.recording = {
    'max_samples': 5,        # 增加样本数量
    'sample_interval': 2.0,  # 增加采样间隔
    # ...
}
```

## 扩展功能

### 添加新按键
```python
# 在按键配置中添加
'new_button': {
    'x': 300, 'y': 300, 'w': 80, 'h': 35,
    'text': '新功能',
    'active': False,
    'enabled': True
}

# 在处理函数中添加逻辑
def _handle_button_click(self, button_name, detections):
    if button_name == 'new_button':
        # 新功能的处理逻辑
        pass
```

### 集成触摸输入
```python
# 添加真实触摸检测
def _check_real_touch(self):
    try:
        if self.touch:
            touch_data = self.touch.read()
            # 处理触摸数据
            return self._process_touch_data(touch_data)
    except:
        pass
    return None
```

## 故障排除

### 常见问题

1. **按键无响应**
   - 检查演示模式是否正常运行
   - 确认按键区域绘制正确
   - 验证点击检测逻辑

2. **记录失败**
   - 确保人脸在检测区域内
   - 检查人脸检测器状态
   - 验证剩余注册槽位

3. **界面显示异常**
   - 检查图像绘制函数
   - 确认分辨率配置正确
   - 验证颜色值定义

### 调试方法
```python
# 启用调试输出
DEBUG = True

# 显示按键状态
print(f"按键状态: {self.buttons}")

# 显示检测结果
print(f"检测数量: {len(detections)}")

# 显示记录状态
print(f"记录状态: {self.recording}")
```

## 实际应用建议

### 产品部署
1. **关闭演示模式**: 设置 `self.demo_mode = False`
2. **添加真实输入**: 集成触摸屏或按键检测
3. **优化界面**: 根据实际屏幕调整布局
4. **性能调优**: 根据硬件能力调整帧率

### 用户体验
1. **视觉反馈**: 确保按键状态清晰可见
2. **操作引导**: 添加更详细的使用说明
3. **错误提示**: 提供友好的错误信息
4. **状态持久化**: 保存用户设置和数据

这个虚拟按键界面提供了完整的无外接按键解决方案，既可以用于演示展示，也可以作为实际产品的基础进行扩展开发。
